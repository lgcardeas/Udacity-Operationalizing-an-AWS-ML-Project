
import base64
import logging
import json
import boto3
#import numpy
logger = logging.getLogger(__name__)
logger.setLevel(logging.DEBUG)

print('Loading Lambda function')

runtime=boto3.Session().client('sagemaker-runtime')
endpoint_Name='pytorch-inference-2024-11-21-00-25-38-124'

def lambda_handler(event, context):

    #x=event['content']
    #aa=x.encode('ascii')
    #bs=base64.b64decode(aa)
    print('Context:::',context)
    print('EventType::',type(event))
    bs=event
    runtime=boto3.Session().client('sagemaker-runtime')
    
    response=runtime.invoke_endpoint(EndpointName=endpoint_Name,
                                    ContentType="application/json",
                                    Accept='application/json',
                                    #Body=bytearray(x)
                                    Body=json.dumps(bs))
    
    result=response['Body'].read().decode('utf-8')
    sss=json.loads(result)
    
    return {
        'statusCode': 200,
        'headers' : { 'Content-Type' : 'text/plain', 'Access-Control-Allow-Origin' : '*' },
        'type-result':str(type(result)),
        'COntent-Type-In':str(context),
        'body' : json.dumps(sss)
        #'updated_result':str(updated_result)

        }
    
"""
EXECUTION LOGS:
    
Status: Succeeded
Test Event Name: (unsaved) test event

Response:
{
  "statusCode": 200,
  "headers": {
    "Content-Type": "text/plain",
    "Access-Control-Allow-Origin": "*"
  },
  "type-result": "<class 'str'>",
  "COntent-Type-In": "LambdaContext([aws_request_id=8d55b91c-793d-4a00-a042-4e4a56e36041,log_group_name=/aws/lambda/deepLearning,log_stream_name=2024/11/22/[$LATEST]8b67217c1c5640a9be23435e6fd830d3,function_name=deepLearning,memory_limit_in_mb=128,function_version=$LATEST,invoked_function_arn=arn:aws:lambda:us-east-1:072298625118:function:deepLearning,client_context=None,identity=CognitoIdentity([cognito_identity_id=None,cognito_identity_pool_id=None])])",
  "body": "[[0.5324065685272217, 0.4684387445449829, -0.0641140341758728, 0.7600868344306946, 0.6890439987182617, -0.04335077852010727, -0.005382196046411991, 0.7151530385017395, 0.30924978852272034, -0.06913919746875763, 0.05900275707244873, 0.6896716356277466, 0.4836483597755432, 0.6001242399215698, 0.3386004865169525, 0.17579838633537292, 0.4749844968318939, 0.5806402564048767, 0.0358523391187191, 0.6599946022033691, 0.6100180149078369, 0.5580198168754578, 0.6223286390304565, 0.3871924877166748, 0.2282901406288147, 0.23377862572669983, 0.3651975393295288, 0.24827444553375244, 0.7226148247718811, -0.19480079412460327, 0.6773086786270142, 0.5573028922080994, 0.45084479451179504, 0.5488142967224121, 0.6378682255744934, 0.7197097539901733, 0.443059504032135, 0.5214617848396301, 0.7417564392089844, 0.4484480619430542, 0.6609351634979248, 0.6278164386749268, 0.5312535166740417, 0.2679920494556427, 0.42725634574890137, 0.6737987995147705, 0.35103458166122437, 0.5213879346847534, 0.46679916977882385, 0.43999171257019043, 0.7434226274490356, 0.47512248158454895, 0.4527736306190491, 0.6622992753982544, 0.5129023790359497, 0.28469914197921753, 0.6819467544555664, 0.507652759552002, 0.4393511712551117, 0.5597814321517944, 0.5963987708091736, 0.4727586507797241, 0.043404776602983475, 0.21965186297893524, 0.34113800525665283, 0.08510997891426086, 0.18214434385299683, 0.6748225688934326, 0.4703866243362427, 0.5240147113800049, 0.11234469711780548, 0.1845380961894989, 0.43444135785102844, 0.371379554271698, 0.3599604368209839, 0.6923415660858154, 0.29279354214668274, 0.40159642696380615, 0.6415702104568481, 0.3855726718902588, 0.20234444737434387, 0.3176968991756439, 0.4334408938884735, 0.12234832346439362, 0.005823259707540274, 0.6270585656166077, 0.49532386660575867, 0.521961510181427, 0.5396470427513123, 0.6062618494033813, 0.41257497668266296, 0.45934274792671204, 0.2450416535139084, 0.35654985904693604, -0.10950838774442673, 0.39099743962287903, 0.5264047384262085, 0.447424054145813, 0.20199322700500488, 0.1628124713897705, 0.44797956943511963, 0.03892870992422104, 0.44143325090408325, 0.017955539748072624, 0.2180778980255127, 0.455690860748291, 0.31810545921325684, 0.11885325610637665, 0.1818154752254486, 0.22366705536842346, 0.443543940782547, -0.012643040157854557, 0.3988003432750702, 0.1868288367986679, 0.48589351773262024, 0.2879556119441986, 0.49738311767578125, 0.5541054010391235, 0.16766268014907837, 0.3616560101509094, 0.08193141967058182, 0.04568175971508026, 0.49792909622192383, 0.507106602191925, 0.2384740114212036, 0.24297679960727692, 0.3288710117340088, -0.10149290412664413, 0.3544238209724426, 0.42875561118125916, 0.2063521444797516, 0.04405510425567627, 0.03716588392853737]]"
}

Function Logs:
START RequestId: 8d55b91c-793d-4a00-a042-4e4a56e36041 Version: $LATEST
Context::: LambdaContext([aws_request_id=8d55b91c-793d-4a00-a042-4e4a56e36041,log_group_name=/aws/lambda/deepLearning,log_stream_name=2024/11/22/[$LATEST]8b67217c1c5640a9be23435e6fd830d3,function_name=deepLearning,memory_limit_in_mb=128,function_version=$LATEST,invoked_function_arn=arn:aws:lambda:us-east-1:072298625118:function:deepLearning,client_context=None,identity=CognitoIdentity([cognito_identity_id=None,cognito_identity_pool_id=None])])
EventType:: <class 'dict'>
END RequestId: 8d55b91c-793d-4a00-a042-4e4a56e36041
REPORT RequestId: 8d55b91c-793d-4a00-a042-4e4a56e36041	Duration: 1864.63 ms	Billed Duration: 1865 ms	Memory Size: 128 MB	Max Memory Used: 94 MB

Request ID: 8d55b91c-793d-4a00-a042-4e4a56e36041
"""